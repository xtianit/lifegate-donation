<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard — Life Gate Ministries</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ===== YOUR ORIGINAL STYLES (UNCHANGED) ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary:#1a472a;--secondary:#d4af37;--accent:#e8b84d;
      --bg:#0a0e12;--card-bg:#111827;--success:#10b981;
      --warning:#f59e0b;--text:#e5e7eb;--text-muted:#9ca3af;--border:#1f2937;
    }
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    .dashboard{max-width:1400px;margin:0 auto;padding:30px 20px}
    header{margin-bottom:40px;padding-bottom:20px;border-bottom:2px solid var(--border)}
    h1{font-family:'Playfair Display',serif;font-size:2.5rem;background:linear-gradient(135deg,var(--secondary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .subtitle{color:var(--text-muted)}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:40px}
    .stat-card{background:var(--card-bg);padding:25px;border-radius:16px;border:1px solid var(--border)}
    .stat-label{font-size:.85rem;color:var(--text-muted);text-transform:uppercase}
    .stat-value{font-size:2.5rem;font-family:'Playfair Display',serif;color:var(--accent)}
    .section{background:var(--card-bg);padding:30px;border-radius:16px;border:1px solid var(--border)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:15px;border-bottom:1px solid var(--border)}
    .export-btn{padding:10px 20px;background:linear-gradient(135deg,var(--secondary),var(--accent));border:none;border-radius:8px;font-weight:600;cursor:pointer}
    .filter-btn{padding:8px 16px;border-radius:8px;background:var(--border);color:var(--text);cursor:pointer}
    .filter-btn.active{background:linear-gradient(135deg,var(--secondary),var(--accent));color:var(--bg)}
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" style="max-width:420px;margin:80px auto;padding:24px;border-radius:14px;background:#111827;">
  <h2 style="color:#d4af37;">Admin Login</h2>
  <input id="adminEmail" type="email" placeholder="Email" style="width:100%;margin-top:12px;padding:10px;">
  <input id="adminPassword" type="password" placeholder="Password" style="width:100%;margin-top:12px;padding:10px;">
  <button id="loginBtn" class="export-btn" style="width:100%;margin-top:16px;">Sign In</button>
  <div id="loginError" style="display:none;color:#fca5a5;margin-top:10px;"></div>
</div>

<!-- ADMIN APP -->
<div id="adminApp" style="display:none;">
  <div style="max-width:1400px;margin:0 auto;text-align:right;padding:10px 20px;">
    <button id="logoutBtn" class="export-btn">Logout</button>
  </div>

  <div class="dashboard">
    <header>
      <h1>Admin Dashboard</h1>
      <p class="subtitle">Life Gate Ministries Worldwide — Real-time Donation Monitoring</p>
    </header>

    <div class="stats-grid">
      <div class="stat-card"><div class="stat-label">Total Donations</div><div class="stat-value">₦<span id="totalAmount">0</span></div></div>
      <div class="stat-card"><div class="stat-label">Donors</div><div class="stat-value"><span id="donorCount">0</span></div></div>
      <div class="stat-card"><div class="stat-label">Average</div><div class="stat-value">₦<span id="avgDonation">0</span></div></div>
      <div class="stat-card"><div class="stat-label">Progress</div><div class="stat-value"><span id="goalProgress">0</span>%</div></div>
    </div>

    <div class="section">
      <div class="filters">
        <button class="filter-btn active" onclick="filterDonations('all',this)">All</button>
        <button class="filter-btn" onclick="filterDonations('stripe',this)">Stripe</button>
        <button class="filter-btn" onclick="filterDonations('paystack',this)">Paystack</button>
        <button class="filter-btn" onclick="filterDonations('today',this)">Today</button>
        <button class="filter-btn" onclick="filterDonations('week',this)">This Week</button>
      </div>

      <table>
        <thead>
          <tr><th>Donor</th><th>Amount</th><th>Provider</th><th>Date</th><th>Ref</th></tr>
        </thead>
        <tbody id="donationsTableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged,signInWithEmailAndPassword,signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,collection,query,orderBy,onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyA6S7F16xzJAwtk3rbwyEoFetkzQpjGqeQ",
  authDomain:"coastal-volt-328002.firebaseapp.com",
  projectId:"coastal-volt-328002"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const loginScreen=document.getElementById("loginScreen");
const adminApp=document.getElementById("adminApp");
const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const loginError=document.getElementById("loginError");

loginBtn.onclick=async()=>{
  loginError.style.display="none";
  try{
    await signInWithEmailAndPassword(auth,adminEmail.value,adminPassword.value);
  }catch(e){
    loginError.textContent=e.message;
    loginError.style.display="block";
  }
};
logoutBtn.onclick=()=>signOut(auth);

let stopCampaign=null,stopDonations=null;
let allDonations=[],currentFilter="all";

function startAdminListeners(){
  const campaignDoc=doc(db,"campaigns","global");

  stopCampaign=onSnapshot(campaignDoc,snap=>{
    const d=snap.data();
    totalAmount.textContent=(d.total/100).toLocaleString();
    donorCount.textContent=d.count||0;
    avgDonation.textContent=((d.total/100)/(d.count||1)).toFixed(2);
    goalProgress.textContent=Math.min((d.total/d.goal)*100,100).toFixed(1);
  });

  const q=query(collection(campaignDoc,"donations"),orderBy("createdAt","desc"));
  stopDonations=onSnapshot(q,snap=>{
    allDonations=snap.docs.map(d=>d.data());
    render();
  });
}

function render(){
  donationsTableBody.innerHTML="";
  allDonations
    .filter(d=>currentFilter==="all"||d.provider===currentFilter)
    .forEach(d=>{
      donationsTableBody.innerHTML+=`
        <tr>
          <td>${d.name||"Anonymous"}</td>
          <td>${d.currency} ${(d.amountMinor/100).toLocaleString()}</td>
          <td>${d.provider}</td>
          <td>${d.createdAt?.toDate().toLocaleString()}</td>
          <td>${d.reference?.slice(0,12)}...</td>
        </tr>`;
    });
}

window.filterDonations=(f,el)=>{
  currentFilter=f;
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  render();
};

onAuthStateChanged(auth,user=>{
  if(user){
    loginScreen.style.display="none";
    adminApp.style.display="block";
    if(!stopCampaign) startAdminListeners();
  }else{
    adminApp.style.display="none";
    loginScreen.style.display="block";
    stopCampaign?.(); stopDonations?.();
    stopCampaign=stopDonations=null;
  }
});
</script>

</body>
</html>
